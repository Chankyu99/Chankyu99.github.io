---
title: "[Statistics] 7장 상관과 회귀"
description: "빅데이터 시대, 올바른 인사이트를 위한 통계X101 데이터분석"
date: 2025-12-12
categories: [Development, Statistics]
tags: [Statistics]
math: true
mermaid: true
---

## 7.1 양적 변수 사이의 관계를 밝히다

양적 변수 사이의 관계를 분석하는 또 다른 방법인 **상관**과 **회귀**에 대해 알아본다.

### **<mark>산점도(scatter plot)</mark>**

두 변수 사이의 관계를 시각적으로 나타내기 위해 산점도를 사용한다. 

산점도는 x축과 y축으로 두 변수를 각각 표시하고, 각 데이터 포인트를 좌표평면에 점으로 표시한다.

![산점도](/assets/img/scatter_plot.png)

### **<mark>상관관계(correlation)</mark>**

_<center>산점도를 보았을 때, 두 변수간 어떤 관계를 파악할 수 있는가?</center>_

![상관관계](/assets/img/correlation.png)

- 증가 : 한 쪽이 큰 값이면 다른 쪽도 큰 값이 나타난다.
- 감소 : 한 쪽이 큰 값이면 다른 쪽은 작은 값이 나타난다.
- 무관(독립) : 한 쪽이 크거나 작은값이어도 다른 쪽 값에 영향을 주지 않는다.

### **<mark>회귀(regression)</mark>**

$y = f(x)$라는 함수를 통해 변수 사이의 관계를 공식화한다.

![회귀](/assets/img/regression.png)

- $x$ : 독립변수(설명변수)
- $y$ : 종속변수(반응변수)

## 7.2 상관관계

### **<mark>상관계수</mark>**

2개의 양적 변수 간 관계의 강도를 정량화하는 **<mark>피어슨 상관계수 $r$</mark>**에 대해 알아본다.

표본크기 $n$인 2개의 양적 변수 데이터를 각각 $x_1, x_2, x_3, ... ,x_n$와 $y_1, y_2, y_3, ... ,y_n$라고 하면 피어슨 상관계수 $r$은 다음과 같다.

$$ r = \frac {\frac 1n \sum_{i=1}^{n}(x_i-\bar x)(y_i-\bar y)}{\sqrt{\frac 1n \sum_{j=1}^{n}(x_j-\bar x)^2} \sqrt{\frac 1n \sum_{k=1}^{n}(y_k-\bar y)^2}} $$

분자는 $x$와 $y$의 **공분산(covariance)**를 나타낸다.

$(x_i - \bar x)(y_i - \bar y)$에서 각 데이터가 평균과의 대소비교를 통해 합으로 표현되어 $x,y$의 연동성 여부를 알 수 있다.

분모는 $x_i$와 $y_i$의 **표준편차**를 나타내며, $r$을 -1에서 1까지의 범위에 머무르게 한다.

직선 관계에 가까울수록 $r$의 절댓값은 1에 가까워지고, $x$와 $y$사이에 아무런 관계가 없을 때는 0이 된다.

즉, $r$의 부호에 따라 세부적인 상관관계를 정의할 수 있다.

- $r$이 양수(**<mark>양의 상관관계</mark>**) : $x$가 커지거나 작아지면 $y$도 커지거나 작아짐
- $r$이 음수(**<mark>음의 상관관계</mark>**) : $x$가 커지면 $y$는 작아지고, $x$가 작아지면 $y$는 커짐

> ⚠️ 주의할 점
> 1. 상관계수는 두 변수간 **"선형"**관계를 나타내므로 비선형 관계는 상관계수로 적절하게 정량화할 수 없다.
> 2. 상관계수가 같더라도, 각기 다른 산점도 패턴이 존재하므로 상관계수로 산점도를 예측하기에는 불충분하다.
> 3. 이상값에 영향을 많이 받으므로 각 변수에 대해 정규성 검사가 이루어져야 한다.
> 4. 2개 변수가 처음부터 종속관계일 때는 주의가 필요하다.

정규성 검사로 정규성이 없다고 판단되는 데이터에는 피어슨 상관계수 대신 비모수 상관계수인 **스피어만 순위상관계수** $\rho$를 사용한다.

정의상 스피어만 순위상관계수는 양적 데이터의 값 자체가 아닌 **순위(rank)**를 기반으로 상관관계를 측정한다.
> [윌콕슨 순위합 검정](/posts/development/2025-12-12-stastics6)이 생각나는군요.

비슷한 값으로 **켄달 순위상관계수** $\tau$를 사용하는 방법이 있다. 이는 표본크기 $n$이 매우 작을 때(10 미만) 유의성검정의 관점에서 더 좋다고 한다.

### **<mark>💡 상관계수와 가설검정</mark>**

추론통계의 원리를 통해 상관계수와 가설검정을 수행할 수 있다.

- $r_p$ : 표본으로 계산된 상관계수
- $r$ : 모집단($r_p$를 가지는 2개의 확률변수로 이루어진 분포)의 상관계수, $r_p$의 추정값이 된다.

모집단의 상관관계가 무상관($r_p = 0$)이어도 표본을 추출해 상관계수를 계산하면 정확히 0이 되는것이 아닌, 0을 중심으로 퍼진 분포로 나타난다.

직관적으로 표현하면 $r_p=0$인 무상관 모집단에서 표본크기 $n=20$인 표본을 추출하고 상관계수 $r$을 계산하는 작업을 여러번 반복해 히스토그램에 시각화한다.

![correlation_histogram](/assets/img/correlation_histogram.png)

이를통해 상관계수의 유의성검정을 수행해보면 다음과 같이 귀무가설, 대립가설을 세울 수 있다.

- $H_0 : r_p = 0$
- $H_1 : r_p \neq 0$

이때 t분포를 이용하여 p값을 계산하는데, 표본에서 얻은 $r_p$가 해당 분포 내 어디에 위치하는지를 보면 된다.

가설검정 시행을 통해서 $p < 0.05$ 임을 알고 나서야 비로소 양의 상관관계가 있다고 주장할 수 있다.

⚠️ **표본크기가 매우 클수록 가설검정의 결과 해석에 주의해야 한다.**
- 표본크기가 클수록 모집단이 귀무가설에서 아주 조금만 어긋나도 p값이 작아진다.
- 때문에 $r$과 $p$ 양쪽 모두를 보고 해석하는 것이 중요하다.

## 7.3 선형회귀

기본 회귀식 $y = f(x)$을 통해 설명변수와 반응변수 사이 관계성을 알 고 새롭게 얻은 설명변수에 의거한 반응변수 예측도 가능하다.

가령 $y = ax + b$의 가장 간단한 예시를 생각해 보면, 회귀식 $f(x)$의 형태를 결정하는 파라미터 $a,b$를 **<mark>회귀계수</mark>**라고 한다.

특정 평가기준에 따라 회귀의 적합도를 평가하고, 이 회귀계수의 값을 구체적으로 구하는 것이 목표이다.

회귀에서도 모집단과 실제 표본의 관계를 확률오차($\epsilon$)를 이용해 만든 확률 모형을 **<mark>회귀모형</mark>**이라고 한다.

$$ y = ax + b + \epsilon $$

그리고 이 회귀식이 파라미터에 관한 1차식이 될때, 혹은 파라미터에 관해 선형인 경우 **<mark>선형회귀</mark>**로 분류한다.

$a,b$는 모집단의 성질을 나타내는 파라미터로, 표본에서 이를 추정하는 것이 목표가 된다.

### **<mark>☝️ 회귀분석을 실행할 때 중요한 점</mark>**
- 어떤 회귀식을 적용할 것인가?
- 어떻게 회귀식을 데이터에 적용할 것인가?
- 얻은 회귀모형을 어떻게 평가할 것인가?

_<center>"파라미터를 데이터로부터 어떻게 결정하는가?"</center>_

데이처와 회귀식의 차이가 가능한 한 작은 값을 가지도록 하기 위한 **<mark>최소제곱법(least squares)</mark>**을 사용한다.

먼저 실제 데이터($y$)값과 회귀식을 통해 얻은 값($\hat y$)의 차이, 즉 **<mark>잔차(residual)</mark>**를 구한다.

이 잔차를 제곱하고, 이를 모집단의 성질을 나타내는 파라미터($a,b$)에 대해 최소화하는 것이 목표가 된다.

$a,b$를 파라미터로 가지는 잔차의 제곱합을 함수로 표현하면 다음과 같이 나타낼 수 있다.

$$ E(a,b) = \sum_{i=1}^{n}(y_i - \hat y_i)^2 = \sum_{i=1}^{n}(y_i - ax_i - b)^2 $$

그런 다음 함수 $E(a,b)$가 최소가 되는 $a,b$를 구하기 위해 $E(a,b)$를 $a$와 $b$에 대해 미분하여 0으로 설정한다.

최소제곱법을 통해 얻게 된 회귀계수를 이용해 **회귀식**을 구할 수 있다.

$$ y = \hat a x + \hat b $$

이때 추정량 $\hat a, \hat b$는 모집단의 성질을 나타내는 파라미터 $a,b$의 비편향추정량이 된다.

$$ E(\hat a) = a, E(\hat b) = b $$

최소제곱법으로 얻은 추정량은 비편향추정량 중에서도 가장 정밀도가 높은 비편향추정량이 된다. 이를 **<mark>최량선형비편향추정량</mark>**이라고 한다. 

### **<mark>회귀계수의 가설검정</mark>**

회귀계수에 대해 역시 **가설검정**이 가능하다. 가장 관심있는 기울기 $a$에 대해 가설검정을 수행할 수 있다.

- $H_0 : a = 0$
- $H_1 : a \neq 0$

귀무가설이 옳다면 설명변수 $x$의 값에 대해 $y$의 변화가 없다는 의미가 된다.

### **<mark>95%의 신뢰구간 & 예측구간</mark>**

- **신뢰구간** : 4장과 마찬가지로 모집단의 회귀계수를 추정하면 신뢰구간을 얻을 수 있다. 
> 표본추출과 회귀분석을 100번 시행했을때, 95번 정도는 이 범위에 모집단의 모형이 포함되었다는 뜻

- **예측구간** : 추정한 회귀모형을 기반으로 데이터 그 자체가 분포하는 구간
> 얻을 수 있는 데이터의 95%를 포함하는 범위를 나타낸다.

### **<mark>결정계수</mark>**

추정한 회귀식이 실제 데이터를 설명하는 정도를 나타내는 **<mark>결정계수(R-squared)</mark>**를 구할 수 있다.

$$ R^2 = 1 - \frac{\sum_{i=1}^{n}(y_i - f(x_i))^2}{\sum_{j=1}^{n}(y_j - \bar y_j)^2} $$

설명되지 않고 남아있는 잔차의 비율을 1에서 빼줌으로서 데이터에 의해 설명된 비율을 나타낸 것이다.

설명변수가 1개인 1차 함수의 선형회귀에서 최소제곱법을 이용한다면, 결정계수는 $x$와 $y$의 상관계수의 제곱으로 간단하게 나타낼 수 있다. 

그러나 설명변수 개수가 늘어날수록 결정계수가 커지는 성질로 인해 의미 없는 설명변수를 도입해도 회귀모형의 설명력이 향상된 것처럼 보일 수 있다.

따라서 설명변수 개수 $k$에 따라 조정한 조정 결정계수 $R'^2$를 사용하여 설명변수의 개수에 따른 결정계수의 차이를 보정할 수 있다.

$$ R'^2 = 1 - \frac {\frac {1}{n-k-1} \sum_{i=1}^{n}(y_i - f(x_i))^2}{\frac {1}{n-1} \sum_{j=1}^{n}(y_j - \bar y_j)^2} $$

### **<mark>오차의 등분산성과 정규성</mark>**

이때까지의 과정에서 우리가 가설검정을 시행하거나 신뢰구간을 얻기위한 조건은 다음과 같다.

(1) 오차항 $\epsilon$의 확률분포가 평균 0, 분산 $\sigma^2$의 정규분포를 따른다.

(2) 등분산성을 가진다.

(1)의 경우 데이터와 모형의 차이인 잔차의 정규성을 **샤피로-윌크 검정**을 통해 확인하면 알 수 있었다.

(2)의 경우 설명변수 $x$가 변할 때 잔차의 분산이 달라지는 지를 조사하는 **브루쉬-페이건 검정(BP 검정)**을 이용한다.

### **<mark>설명변수와 반응변수</mark>**

상관과 달리 회귀에는 설명변수 $x$와 반응변수 $y$라는 **비대칭성**이 존재한다.

다음 목적에 따라 무엇을 정의할지 달라질 수 있다.

- 한쪽 변수로 다른 한쪽 변수를 설명하고자 할 때

설명하는 쪽을 설명변수, 설명할 대상을 반응변수로 설정한다.

- 인과효과를 알고 싶을 때

원인을 설명변수로, 결과를 반응변수로 설정한다. 이때 올바르게 인과효과를 추정하기 위해서는 서로 다른 $x$에 대해 그 밖의 요인이 같아야만 한다.

- 데이터를 예측하고 싶을 때

예측의 근거가 될 변수를 설명변수, 예측하고자 하는 변수를 반응변수로 설정한다.
